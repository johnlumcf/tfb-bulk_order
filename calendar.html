<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync Order</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #f2f2f7; margin: 0; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 350px; text-align: center; }
        h1 { margin: 0 0 5px 0; color: #1c1c1e; font-size: 22px; }
        .loc { color: #8e8e93; font-weight: 600; font-size: 13px; text-transform: uppercase; margin-bottom: 25px; display: block; }
        
        /* APPLE BUTTON */
        .btn-ios { 
            background: #007AFF; color: white; padding: 16px; 
            border-radius: 14px; text-decoration: none; font-weight: 700; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; font-size: 16px; margin-bottom: 12px;
            box-sizing: border-box;
        }
        
        /* GOOGLE BUTTON */
        .btn-google { 
            background: white; color: #3c4043; padding: 15px; 
            border-radius: 14px; text-decoration: none; font-weight: 600; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; font-size: 16px; border: 1px solid #dadce0;
            box-sizing: border-box;
        }

        .icon { font-size: 20px; }
        .divider { font-size: 12px; color: #ccc; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="card">
        <h1 id="title">Loading...</h1>
        <span id="loc" class="loc">Please wait</span>

        <!-- BUTTON 1: iOS / File -->
        <a id="iosBtn" href="#" class="btn-ios">
            <span class="icon">üçé</span> Apple Calendar
        </a>

        <div class="divider">OR</div>

        <!-- BUTTON 2: Google / Android -->
        <a id="googleBtn" href="#" class="btn-google">
            <span class="icon">üìÖ</span> Google Calendar
        </a>
    </div>

    <script>
        // 1. Get Params
        const params = new URLSearchParams(window.location.search);
        const title = params.get('t') || "Order";
        const desc = params.get('d') || "";
        const loc = params.get('loc') || "";
        const dateStr = params.get('dt');

        document.getElementById('title').innerText = title;
        document.getElementById('loc').innerText = loc ? "üìç " + loc : "Syncing...";

        // 2. PASTE YOUR GOOGLE SCRIPT URL HERE
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwhp4vdTZjuID1jSZyNp2YboOZ0fOI6hW6oWHvhTtnd6kVoUiINsthZygB0tSSkV2vf5w/exec"; 

        if (dateStr) {
            const startDate = new Date(dateStr);
            const endDate = new Date(startDate.getTime() + (60 * 60 * 1000)); // 1 Hour

            // --- A. GOOGLE CALENDAR DEEP LINK (The "Auto Inject" feel) ---
            // Format: YYYYMMDDTHHmmssZ
            const fmt = d => d.toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";
            
            const gLink = `https://www.google.com/calendar/render?action=TEMPLATE` + 
                          `&text=${encodeURIComponent(title)}` + 
                          `&details=${encodeURIComponent(desc)}` + 
                          `&location=${encodeURIComponent(loc)}` + 
                          `&dates=${fmt(startDate)}/${fmt(endDate)}`;
            
            document.getElementById('googleBtn').href = gLink;

            // --- B. APPLE / ICS FILE LINK ---
            const fileLink = SCRIPT_URL + 
                "?mode=ics" +
                "&title=" + encodeURIComponent(title) +
                "&desc=" + encodeURIComponent(desc) +
                "&loc=" + encodeURIComponent(loc) +
                "&date=" + encodeURIComponent(dateStr);

            document.getElementById('iosBtn').href = fileLink;
        }
    </script>
</body>
</html>
