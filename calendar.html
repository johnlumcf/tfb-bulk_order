<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync Calendar</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #f2f2f7; margin: 0; padding: 20px; text-align: center; }
        .card { background: white; padding: 40px 30px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 350px; }
        h1 { margin: 0 0 10px 0; color: #1c1c1e; font-size: 22px; }
        p { color: #8e8e93; margin-bottom: 30px; font-size: 15px; }
        
        /* THE BUTTON */
        .btn { 
            background: #007AFF; color: white; padding: 18px 0; 
            border-radius: 16px; text-decoration: none; font-weight: 700; 
            display: block; width: 100%; font-size: 18px; 
            box-shadow: 0 4px 10px rgba(0,122,255,0.3);
        }
        .btn:active { transform: scale(0.98); }
    </style>
</head>
<body>

    <div class="card">
        <h1 id="title">Loading...</h1>
        <p id="loc">Please wait</p>
        
        <!-- This button will point to a Real File on Agical Servers -->
        <a id="downloadBtn" href="#" class="btn">Add to Calendar</a>
    </div>

    <script>
        // 1. Get Details from URL
        const params = new URLSearchParams(window.location.search);
        const title = params.get('t') || "Order";
        const desc = params.get('d') || "";
        const loc = params.get('loc') || "";
        const dateStr = params.get('dt');

        // 2. Update Text on Screen
        document.getElementById('title').innerText = title;
        document.getElementById('loc').innerText = loc ? "üìç " + loc : "Syncing...";

        // 3. Format Date for Agical API
        // We need 1 Hour duration calculated
        let startIso = "";
        let endIso = "";

        if (dateStr) {
            const startDate = new Date(dateStr);
            const endDate = new Date(startDate.getTime() + (60 * 60 * 1000)); // +1 Hour
            
            // Format: YYYY-MM-DDTHH:mm:ss
            startIso = startDate.toISOString().split('.')[0];
            endIso = endDate.toISOString().split('.')[0];
        }

        // 4. Construct the Real File Link (Agical API)
        // This creates a physical .ics file on their server that phones TRUST.
        const agicalUrl = `https://agical.io/daily/event` +
                          `?summary=${encodeURIComponent(title)}` +
                          `&description=${encodeURIComponent(desc)}` +
                          `&location=${encodeURIComponent(loc)}` +
                          `&startdt=${encodeURIComponent(startIso)}` +
                          `&enddt=${encodeURIComponent(endIso)}`;

        // 5. Attach to Button
        document.getElementById('downloadBtn').href = agicalUrl;

    </script>
</body>
</html>
